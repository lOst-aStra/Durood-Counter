# Story 1.1: Initialize Android app skeleton

## Status
Done

## Story
As a developer,
I want a Kotlin + Compose M3 single-activity project scaffold,
so that I can implement the core counter UI quickly and cleanly.

## Acceptance Criteria
1. Project uses Kotlin + Compose M3 with Single-Activity + MVVM setup [Source: docs/prd/epic-1-foundation-core-counter.md#L11]
2. App builds and runs on Android 12+ device/emulator [Source: docs/prd/epic-1-foundation-core-counter.md#L12]
3. Basic theme and typography applied [Source: docs/prd/epic-1-foundation-core-counter.md#L14]

## Tasks / Subtasks
- [x] Initialize Android project with Kotlin and Compose M3 using specified toolchain and SDK levels (AGP 8.6.0, Gradle 8.9, Kotlin 2.0.20; Min SDK 31, Target/Compile 35) (AC: 1, 2)
  - [x] Configure repositories `google()` and `mavenCentral()` [Source: docs/architecture-shards/build-and-dependencies.md]
  - [x] Enable Compose in build features and set Kotlin jvmTarget=17 [Source: docs/architecture-shards/build-and-dependencies.md]
  - [x] Add Compose BOM 2025.06.00, Activity Compose, Lifecycle, and testing deps [Source: docs/architecture-shards/build-and-dependencies.md]
- [x] Set application ID/namespace to `com.lostastra.duroodcounter` (AC: 1, 2) [Source: docs/architecture-shards/build-and-dependencies.md]
- [x] Create single-activity entry with Compose `setContent {}` and minimal scaffold (AC: 1, 2)
  - [x] MainActivity in `app/src/main/java/com/lostastra/duroodcounter/` [Source: docs/architecture-shards/modules-and-packages.md]
- [x] Establish package structure and placeholder files (AC: 1)
  - [x] `ui/` with `theme/` folder and empty `Theme.kt`, `Type.kt`, `Color.kt` [Source: docs/architecture-shards/modules-and-packages.md]
  - [x] `presentation/` with placeholder `CounterViewModel.kt` and `CounterState.kt` (stubs) [Source: docs/architecture-shards/viewmodel-and-state.md]
  - [x] `data/` with placeholder `CounterRepository.kt` and `datastore/CounterLocalDataSource.kt` (stubs) [Source: docs/architecture-shards/modules-and-packages.md]
  - [x] `core/` with placeholder `Haptics.kt` (stub) [Source: docs/architecture-shards/ui-composition.md]
  - [x] `di/` with `AppModule.kt` for manual wiring (simple provider functions) [Source: docs/architecture-shards/modules-and-packages.md]
- [x] Apply basic theme and typography (AC: 3)
  - [x] Wire `MaterialTheme` with `Color.kt` and `Type.kt` [Source: docs/architecture-shards/ui-composition.md]
  - [x] Add fonts to `app/src/main/res/font/` and reference in `Type.kt` (Noto Naskh Arabic, Nunito) [Source: docs/architecture-shards/ui-composition.md]
- [x] Configure `AndroidManifest.xml` with `android:supportsRtl="true"` (AC: 3) [Source: docs/architecture-shards/ui-composition.md]
- [x] Run on Android 12+ emulator/device to confirm successful build and launch (AC: 2)
- [x] Add basic unit and instrumentation test scaffolding for future stories [Source: docs/architecture-shards/testing-strategy.md]

## Dev Notes

### Previous Story Insights
No previous stories. This is the first story of Epic 1.

### Data Models
- No specific data schema implemented in this story. Persistence comes in Story 1.3. [Source: docs/architecture-shards/data-model-and-persistence.md]

### API Specifications
- No network or external API usage in this story.

### Component Specifications
- Prepare Compose M3 setup with theming and typography per UI composition guidance.
  - Bundle fonts: `noto_naskh_arabic_regular.ttf`, `nunito_variable.ttf` in `res/font/`. [Source: docs/architecture-shards/ui-composition.md]
  - Define `Type.kt` and wire into `MaterialTheme(typography)`. [Source: docs/architecture-shards/ui-composition.md]
  - Prepare for haptics utilities to be triggered from ViewModel in later story. [Source: docs/architecture-shards/ui-composition.md]

### File Locations
- App module: `app/`
- Packages and key files:
  - `com.lostastra.duroodcounter.ui` → `theme/Color.kt`, `theme/Type.kt`, `theme/Theme.kt` [Source: docs/architecture-shards/modules-and-packages.md]
  - `com.lostastra.duroodcounter.presentation` → `CounterViewModel.kt`, `CounterState.kt` [Source: docs/architecture-shards/viewmodel-and-state.md]
  - `com.lostastra.duroodcounter.data` → `CounterRepository.kt`, `datastore/CounterLocalDataSource.kt` [Source: docs/architecture-shards/modules-and-packages.md]
  - `com.lostastra.duroodcounter.core` → `Haptics.kt` [Source: docs/architecture-shards/ui-composition.md]
  - `com.lostastra.duroodcounter.di` → `AppModule.kt` [Source: docs/architecture-shards/modules-and-packages.md]

### Testing Requirements
- Set up unit test and androidTest modules for later stories. Initial checks:
  - Project builds, MainActivity launches Compose content. [Source: docs/architecture-shards/testing-strategy.md]
  - Compose UI test dependencies added; basic smoke test can be added in later stories. [Source: docs/architecture-shards/testing-strategy.md]

### Technical Constraints
- Tooling: Gradle 8.9, AGP 8.6.0, Kotlin 2.0.20; Java toolchain 17. [Source: docs/architecture-shards/build-and-dependencies.md]
- SDKs: Compile/Target 35, Min 31. [Source: docs/architecture-shards/build-and-dependencies.md]
- Performance: keep cold start ≤ 1.5s; avoid heavy work in Application/Activity onCreate. [Source: docs/architecture-shards/performance.md]
- Keep DI minimal and avoid reflection-heavy frameworks at MVP stage. [Source: docs/architecture-shards/modules-and-packages.md]

## Testing
- CI step or local verification to build and launch on an Android 12+ emulator meets AC #2. [Source: docs/architecture-shards/testing-strategy.md]

## Change Log
| Date       | Version | Description                            | Author |
|------------|---------|----------------------------------------|--------|
| 2025-09-14 | 0.1     | Initial draft created from PRD + Arch. | SM     |

## Dev Agent Record
- Agent Model Used: Cascade
- Debug Log References:
- Completion Notes List:
  - Scaffolded Android project with Kotlin + Compose M3, namespace `com.lostastra.duroodcounter`, single-activity entry, package skeleton, and test scaffolding.
  - Manifest updated with `supportsRtl=true` and no XML theme dependency; Compose theme applied in code.
  - Fonts added and wired: `res/font/nunito_semibold.ttf`, `res/font/notonaskharabic_semibold.ttf`; `ui/theme/Type.kt` updated to use these via `FontFamily` and `Typography`.
  - Built in Android Studio and deployed to a physical device running Android 12+; app launched successfully.
- File List:
  - `settings.gradle.kts`
  - `build.gradle.kts`
  - `gradle.properties`
  - `app/build.gradle.kts`
  - `app/proguard-rules.pro`
  - `app/src/main/AndroidManifest.xml`
  - `app/src/main/java/com/lostastra/duroodcounter/MainActivity.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/ui/theme/Color.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/ui/theme/Type.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/ui/theme/Theme.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/presentation/CounterState.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/presentation/CounterViewModel.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/data/CounterRepository.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/data/datastore/CounterLocalDataSource.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/core/Haptics.kt`
  - `app/src/main/java/com/lostastra/duroodcounter/di/AppModule.kt`
  - `app/src/test/java/com/lostastra/duroodcounter/ExampleUnitTest.kt`
  - `app/src/androidTest/java/com/lostastra/duroodcounter/ExampleInstrumentedTest.kt`

## QA Results
- Review Date: 2025-09-14 20:55 IST
- Reviewer: Quinn (QA) — Test Architect & Quality Advisor

### Summary
Implementation meets the story scope for a Kotlin + Compose M3 single-activity scaffold with basic theming/typography, correct SDK and toolchain, and placeholder architecture. Evidence collected from:
- Build config: `app/build.gradle.kts` (AGP 8.6.0, Kotlin 2.0.20, compile/target 35, min 31, Compose BOM 2025.06.00, Activity Compose, Lifecycle, Coroutines, DataStore 1.1.1)
- Entry point: `app/src/main/java/com/lostastra/duroodcounter/MainActivity.kt` uses `setContent { DuroodCounterTheme { Scaffold { … } } }`
- Theming: `ui/theme/Theme.kt`, `Type.kt`, `Color.kt` wired into `MaterialTheme`
- Fonts present and referenced: `app/src/main/res/font/nunito_semibold.ttf`, `notonaskharabic_semibold.ttf`
- Manifest: `AndroidManifest.xml` has `android:supportsRtl="true"`
- Test scaffolding exists under `app/src/test/` and `app/src/androidTest/`

### Acceptance Criteria Verification
- AC1 (Kotlin + Compose M3 Single-Activity + MVVM setup): PASS
  - `MainActivity.kt` uses Compose; packages scaffolded for `presentation/`, `data/`, `core/`, `di/` with stubs.
- AC2 (Builds and runs on Android 12+): PROVISIONALLY PASS
  - Evidence indicates correct SDK/toolchain; Dev notes report successful run on Android 12+. Manual CI/local build recommended for repeated verification.
- AC3 (Basic theme and typography applied): PASS
  - `DuroodCounterTheme` applies `Typography` and light color scheme; fonts wired correctly.

### Risks, NFRs, and Testability Notes
- Haptics utility (`core/Haptics.kt`) uses `Vibrator`/`VibratorManager`. Consider declaring the normal permission `android.permission.VIBRATE` in `AndroidManifest.xml` to avoid OEM-specific behavior variations.
- Release `minifyEnabled=true` without additional rules appears fine for current minimal code base; monitor for Compose/Reflection issues as features grow.
- Performance: Current scaffold is light; no obvious cold-start risks. Continue to avoid heavy work in `onCreate`.
- Testability: ViewModel uses `StateFlow`; good basis for unit/UI tests in later stories.

### Recommendations (Non-blocking)
1) Add `uses-permission android:name="android.permission.VIBRATE"` if haptics will be used in upcoming stories.
2) Add a lightweight CI check: `./gradlew assembleDebug testDebugUnitTest` to continuously validate AC2.
3) Consider a simple Compose UI smoke test in `androidTest` for launch verification in next story.

### Gate Decision
- Decision: PASS
- Rationale: All acceptance criteria are satisfied or provisionally satisfied with evidence. No blocking risks identified.
